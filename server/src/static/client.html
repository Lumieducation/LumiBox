<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
</head>

<body>
    <pre id="resources">
    </pre>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var subscriptions = {
            '/resources': function (result) {
                document.getElementById('resources').innerHTML = JSON.stringify(result, null, 2)
            }
        }

        var socket = io('http://' + window.location.host);
        socket.on('connect', function () {
            var keys = Object.keys(subscriptions);
            for (var i=0; i<keys.length; i++) {
                socket.emit('subscribe', keys[i])
            }
        });
        socket.on('update', function (data) {
            if (subscriptions[data.query]) {
                subscriptions[data.query](data.result)
            }
        });
        socket.on('disconnect', function () { 
            console.log('socket::disconnect') 
        });
    </script>
</body>

</html>